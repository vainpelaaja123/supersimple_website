<!DOCTYPE html>
<html>
<head>
    <title>Recent Tracks</title>
    <style>
        ul {
            list-style: none;
            padding: 0;
        }
        
        li {
            margin-bottom: 10px;
        }

        #myImage{

            border-radius: 10px;
           
            
        }

        #currentlyPlaying{

            font-size: 20px;
        
        }

    </style>
</head>
<body>
    <h1></h1>
    <ul id="track-list"></ul>
    
    <img id="myImage" alt="album art">
    <div id="currentlyPlaying"></div>
    

    <script>
        // Function to fetch and display the data
        function fetchAndDisplayData() {
            var url = 'https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=vainpelaaja123&api_key=1e7a90f18093d941dedadf8f27864bf3&format=json';

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    var recentTracks = data.recenttracks.track;
                    var trackList = document.getElementById('track-list');

                    // Check if there is a currently playing track
                    if (recentTracks[0]['@attr'] && recentTracks[0]['@attr'].nowplaying === 'true') {
                        var artist = recentTracks[0].artist['#text'];
                        var trackName = recentTracks[0].name;
                        var imageUrl = data.recenttracks.track[0].image.find(img => img.size === 'large')["#text"];

                        console.log(imageUrl);

                        // Set the src attribute of the image element
                        var imageElement = document.getElementById('myImage');
                        imageElement.src = imageUrl;                        

                        

                       

                        var currentlyPlayingText = `I'm currently listening to:   ${trackName} by <strong>${artist}</strong>`;
                        currentlyPlaying.innerHTML = currentlyPlayingText;
                        
                    } else {
                        currentlyPlaying.innerHTML = "Looks like I'm not listening to anything. Here are the last 10 songs I listened to: ";
                        // Display the last 10 tracks
                        recentTracks.slice(0, 10).forEach(function(track) {
                            var artist = track.artist['#text'] || 'Unknown Artist';
                            var trackName = track.name || 'Unknown Track';
                            
                            

                            var listItem = document.createElement('li');
                            listItem.innerHTML = `${trackName} by <strong>${artist}</strong>`;
                            trackList.appendChild(listItem);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // Call the function to fetch and display the data
        fetchAndDisplayData();

        setInterval( fetchAndDisplayData, 20000);

    </script>
</body>
</html>
